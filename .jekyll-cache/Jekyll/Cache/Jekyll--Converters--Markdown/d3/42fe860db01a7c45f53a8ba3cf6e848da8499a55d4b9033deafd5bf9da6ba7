I"¢!<h1 id="tutorial-build-the-c-soap-sample-library">Tutorial: Build The C# SOAP Sample Library</h1>
<p><em>Author: Scott Hurrey</em><br />
<em>Categories: [â€˜Getting Startedâ€™, â€˜SOAP Web Servicesâ€™, â€˜Tutorialsâ€™]</em><br />
<em>Tags: [â€˜web servicesâ€™, â€˜soapâ€™, â€˜c#â€™, â€˜tutorialâ€™, â€˜blackboard learnâ€™, â€˜sample codeâ€™, â€˜sample client libraryâ€™, â€˜developerâ€™]</em></p>
<hr />

<p>The first step to building the .NET Web Services sample desktop application is
to build the library that handles the communication between that client and
Blackboard Learn. This library can also be used from within Microsoftâ„¢ Visual
StudioÂ® to build custom applications, without having to build the
communication protocols. If you choose to build your own, you have access to
all of the code used herein.</p>

<h2 id="prerequisites">Prerequisites</h2>

<ul>
  <li>Microsoftâ„¢ <a href="https://www.microsoft.com/downloads/details.aspx%3FFamilyID%3D1ba1f631-c3e7-420a-bc1e-ef18bab66122%26DisplayLang%3Den">Web Services Extensions 2.0 Service Pack 3</a></li>
  <li><a href="About%20Web%20Services%20Sample%20Code.html">Client.zip</a> archive from the Blackboard Learn User Interface</li>
  <li>Web Services are <a href="https://help.blackboard.com/en-us/Learn/9.1_2014_04/Administrator/070_Server_Management_and_Integrations/System_Integration/Integration_Development/030_Web_Services">Available and Discoverable</a></li>
</ul>

<h2 id="assumptions">Assumptions</h2>

<ul>
  <li>This sample was written based on instructions for Microsoftâ„¢ Visual StudioÂ® 2010 Express Edition. There is sample code specific to several versions of Visual Studio, so some steps may vary slightly. The most fluid item is the location of wsdl.exe.</li>
  <li>This seems to change depending upon the version of Microsoftâ„¢WindowsÂ® and the version of Visual Studio installed. The path to this file is required to generate the sample code used to build this library.</li>
  <li>That said, there is no known restriction as to which version of Microsoft Visual Studio you use. Using a version other than the versions that Blackboard supplies specific solutions for may require additional configuration changes to build the software.</li>
</ul>

<h2 id="build-it">Build It</h2>

<p>The sample code must be built from the command line. To access the command
line in Microsoft Windows, click on the â€˜Startâ€™ menu, click run, type .html and
click ok. Once you are at the command prompt, navigate to the dotnetclient
sub-directory where you unzipped the client.zip file.</p>

<p>In this directory, you will see a file called sampleGenClient..html. Edit this
file in your favorite text editor. When this script is executed, it will reach
out to your Blackboard instance and retrieve the wsdl for each of the
available web services in order to generate the code. This requires access to
the wsdl.exe executable that is part of the Microsoft Visual Studio
Installation. This is set in the sampleGenClient..html file.</p>

<p>Locate the line in the file that reads set DOTNETBIN= and set it to the
appropriate path. Do not include wsdl.exe in the path. This will be appended
by the script. This file may be located in several locations depending upon
the version of Visual Studio and Windows. You might find this file in the
following locations.</p>

<table>
  <thead>
    <tr>
      <th>OS</th>
      <th>Application</th>
      <th>WSDL.exe Location</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Windows 7</td>
      <td>Visual Studio 2010 Express</td>
      <td>C:\Program Files\Microsoft SDKs\Windows\v6.0A\bin</td>
    </tr>
    <tr>
      <td>Windows Server 2008 R2</td>
      <td>Visual Studio 2010 Express</td>
      <td>C:\Program Files (x86)\Microsoft SDKs\Windows\v7.0A\Bin</td>
    </tr>
  </tbody>
</table>

<p>Once this edit has been made, save the file. Now from the command line, and in
the dotnetclient directory, type the following:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    sampleGenClient..html http://&lt;blackboard learn domain&gt;
</code></pre></div></div>

<p>WARNING: <em>You will see error messages similar to the one below. You can safely
ignore these messages.</em></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    Schema validation warning: Schema item 'element' named 'getServerVersion' from namespace 'http://util.ws.blackboard' is invalid. Namespace 'http://ws.platform.blackboard/xsd' is not available to be referenced in this schema. Schema validation warning: Schema item 'element' named 'getServerVersionResponse' from namespace 'http://util.ws.blackboard' is invalid. Namespace 'http://ws.platform.blackboard/xsd' is not available to be referenced in this schema. Schema validation warning: Schema item 'element' named â€˜getDataSourcesResponse' from namespace 'http://util.ws.blackboard' is invalid. Namespace 'http://util.ws.blackboard/xsd' is not available to be referenced in this schema. Schema validation warning: Schema item 'element' named 'checkEntitlement' from namespace 'http://util.ws.blackboard' is invalid. Namespace 'http://ws.platform.blackboard/xsd' is not available to be referenced in this schema. Warning: Schema could not be validated. Class generation may fail or may produce incorrect results. Writing file 'C:\Users\username\Blackboard\Developer Tools\Web Services\dotnetclient\BbWsClient\gen\UtilWS.cs'.
</code></pre></div></div>

<p>Once the sample code has been generated, the next step is to build the code
into a re-usable library. To do this, you must first open Microsoft Visual
Studio. Once the application is open, select <strong><em>File &gt; Open</em></strong> from the menu
and navigate to and open the â€¦/dotnetclient/BbWsClient/BbWsClient2010.sln
file.</p>

<p>If you are going to use this code in a production environment, you will need
to add code to handle load balanced environments. The best way to do this is
to modify the WebserviceWrapper.cs file to add a CookieContainer to each
initialize call.</p>

<p>For example, the initAnnoucement(UsernameToken userToken) method looks like
the following:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    announcement = new AnnouncementWS();  
    announcement.Url = baseUrl + "/Announcement.WS";   
    announcement.RequestSoapContext.Security.Tokens.Add(userToken);  
</code></pre></div></div>

<p>Simply modify the method as illustrated below to enable the cookie container.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    announcement = new AnnouncementWS();   
    announcement.CookieContainer = new System.Net.CookieContainer();Â  //HANDLE STICKY COOKIES   
    announcement.Url = baseUrl + "/Announcement.WS";   
    announcement.RequestSoapContext.Security.Tokens.Add(userToken);
</code></pre></div></div>

<p>You must make this change to all of the init<WebService> methods you plan to
implement.</WebService></p>

<p>Now simply build the project. To do this, right-click the BbWsClient2010
project in the Solution Explorer and select Build from the contextual menu.
This will create the Dynamic Link Library (.dll) file as either
â€¦/dotnetclient/BbWsClient/bin/Debug/BbWsClient.dll or
../dotnetclient/BbWsClient/bin/Release/BbWsClient.dll.</p>

<p>The .dll file can be imported into other projects, or, as you will see in
subsequent help topics, can be added to in order to create custom
applications.</p>

<h3 id="gradebookws-wsdl-and-learn-october-2014">Gradebook.WS WSDL and Learn October 2014</h3>

<p>A bug in the Blackboard Learn 9.1 October 2014 release with the WSDL for
gradebook.ws causes the code generation to fail when trying to ingest the this
WSDL.</p>

<p>For more information and workarounds for this bug, see the Behind the
Blackboard article <a href="https://blackboard.secure.force.com/btbb_articleview?id=kA370000000H5Fc">Gradebook.WS wsdl not Able to be Consumed due to Invalid
RuntimeException Declaration</a>.</p>

<p>If you follow workaround 1, simply change the initial gradebookWS call:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    url = url_header + 'Gradebook.WS?wsdl'
</code></pre></div></div>

<p>with this:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    url = 'file:///Users/username/wsdl/Gradebook.xml'
</code></pre></div></div>

<p>Just be sure to replace my absolute path to the absolute path on your file
system.</p>

<p>If you follow workaround 2, the code should work as-is.</p>

:ET