I"úP<h1 id="rest-demo-using-python">REST Demo Using Python</h1>
<p><em>Author: Mark Oâ€™Neil</em><br />
<em>Categories: []</em><br />
<em>Tags: [â€˜restâ€™, â€˜javaâ€™, â€˜blackboard learnâ€™, â€˜exampleâ€™, â€˜sample codeâ€™, â€˜saasâ€™, â€˜developerâ€™]</em></p>
<hr />

<p>The rest demo script demonstrates authenticating a REST application,
management and use of the authorization token, and creating, updating,
discovering, and deleting supported Learn objects.</p>

<h2 id="prerequisites">Prerequisites</h2>

<ul>
  <li>You must <a href="Register%20as%20a%20Developer%20and%20Manage%20Your%20Applications%20with%20the%20Developer%20Portal.html">register a developer account and application</a> in the Developer Portal</li>
  <li>You must 
<a href="Managing%20REST%20Integrations%20in%20Learn.html">register your application</a> in Blackboard Learn</li>
  <li>You must also configure the script as outlined in the README for the project</li>
</ul>

<p>This webapp allows you to:</p>

<ul>
  <li>Authenticate</li>
  <li>Create, Read, and Update a Data Source</li>
  <li>Create, Read, and Update a Term</li>
  <li>Create, Read, and Update a Course</li>
  <li>Create, Read, and Update a User</li>
  <li>Create, Read, and Update a Membership</li>
  <li>Delete created objects in reverse order of create - membership, user, course, term, datasource.</li>
</ul>

<p>All generated output is sent to the terminal console.</p>

<p><strong>This is not meant to be a Python tutorial. It will not teach you to write code
in Python. It will, however, give a Developer familiar with Python the
knowledge necessary to build a REST-based Web Services integration.</strong></p>

<h3 id="assumptions">Assumptions</h3>

<p>This help topic assumes the Developer:</p>

<ul>
  <li>is familiar with Python</li>
  <li>has obtained a copy of the<a href="https://github.com/blackboard/BBDN-REST-DEMO_Python"> source code</a> and run as noted in the project <a href="https://github.com/blackboard/BBDN-REST-DEMO_Python/blob/master/README.html">README.html</a> file.</li>
  <li>has a REST-enabled Blackboard Learn instance.</li>
</ul>

<h3 id="code-walkthrough">Code Walkthrough</h3>

<p>To build an integration with the Blackboard REST Web Services, regardless of
the programming language of choice, can really be summed up in two steps:</p>

<ol>
  <li>Use the Application Key and Secret to obtain an OAuth 2.0 access token, as described in the <a href="Basic%20Authentication.html">Basic Authentication</a> document.</li>
  <li>Call the appropriate REST endpoint with the appropriate data to perform the appropriate action.</li>
</ol>

<h4 id="authorization-and-authentication">Authorization and Authentication</h4>

<p>The REST Services rely on OAuth 2.0 Bearer Tokens for authentication. A
request is made to the token endpoint with a Basic Authorization header
containing the base64-encoded key:secret string as its key. The token service
returns a JSON object containing the Access Token, the Token Type, and the
number of seconds until the token expires. The token is set to expire after
one hour, and subsequent calls to retrieve the token will return the same
token with an updated expiry time until such time that the token has expired.
There is no refresh token and currently no revoke token method.</p>

<p>The Python code handles authentication and token management in the auth class
in auth.py:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    Â Â Â  def __init__(self, URL):
    Â Â Â Â Â Â Â  self.SECRET = "insert_your_application_key_here"
    Â Â Â Â Â Â Â  self.KEY = "insert_your_application_secret_here"
    Â Â Â Â Â Â Â  self.CREDENTIALS = 'client_credentials'
    Â Â Â Â Â Â Â  self.PAYLOAD = {
    Â Â Â Â Â Â Â Â Â Â Â  'grant_type':'client_credentials'
    Â Â Â Â Â Â Â  }
    Â Â Â Â Â Â Â  self.TOKEN = None
    Â Â Â Â Â Â Â  self.target_url = URL
    Â  ...
    Â Â  def setToken(self):
    Â Â Â Â Â Â Â  oauth_path = '/learn/api/public/v1/oauth2/token'
    Â Â Â Â Â Â Â  OAUTH_URL = 'https://' + self.target_url + oauth_path
    Â Â Â Â Â Â Â  if self.TOKEN is None:
    Â Â Â Â Â Â Â Â Â Â Â  session = requests.session()
    Â Â Â Â Â Â Â Â Â Â Â  session.mount('https://', Tls1Adapter()) # remove for production
    Â Â Â Â Â Â Â  # Authenticate
    Â Â Â Â Â Â Â Â Â Â Â  r = session.post(OAUTH_URL, data=self.PAYLOAD, auth=(self.KEY, self.SECRET), verify=False)
    Â Â Â Â Â Â Â Â Â Â Â  print("[auth:setToken()] STATUS CODE: " + str(r.status_code) )
    Â Â Â Â Â Â Â Â Â Â Â  print("[auth:setToken()] RESPONSE: " + r.text)
    Â Â Â Â Â Â Â Â Â Â Â  if r.status_code == 200:
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  parsed_json = json.loads(r.text)
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  self.TOKEN = parsed_json['access_token']
    ...
</code></pre></div></div>

<p>The JSON response is parsed to retrieve the Token which is stored and
retrieved for subsequent calls by calling <code class="highlighter-rouge">auth.getToken()</code>. Note that the
retrieving the stored token invokes a sanity check on token expiration,
requesting a fresh token if nearly expired - see <code class="highlighter-rouge">auth.getToken()</code> and
<code class="highlighter-rouge">auth.isExpired()</code>.</p>

<h4 id="calling-services">Calling Services</h4>

<p>The individual service calls are handled by Python in service specific class
files:</p>

<ul>
  <li>datasource.py</li>
  <li>term.py</li>
  <li>course.py</li>
  <li>user.py</li>
  <li>membership.py</li>
</ul>

<p>A sixth file <code class="highlighter-rouge">constants.py</code> contains a set of constants used by the application.</p>

<p>Each of these classes creates the JSON body when appropriate and then calls
the appropriate HTTP Request, and return the JSON response as a String to be
displayed in the terminal console window.</p>

<p>In the demo restdemo.py, each of the above objects are called using POST to
create, PATCH to update, GET to read, and DELETE to delete the target object.
Note that memberships use PUT to create a membership.</p>

<p>End points are generally defined as <code class="highlighter-rouge">/learn/api/public/v1/&lt;object
type&gt;/&lt;objectId&gt;</code>. Object ID can be either the pk1, like <code class="highlighter-rouge">_1_1</code>, or as the
batch_uid. This value should be prepended by externalId:, like
<code class="highlighter-rouge">externalId:test101</code>.</p>

<p>For example, to retrieve a course by the pk1 <code class="highlighter-rouge">_1_1</code>, you would call <strong>GET
/learn/api/public/v1/courses/_1_1</strong>. To retrieve by the batch_uid <code class="highlighter-rouge">test101</code>,
you would call <strong>GET /learn/api/public/v1/courses/externalId:test101.</strong></p>

<p>Create is sent to Learn as a HTTP POST message with a JSON body that defines
the object. The endpoint should omit the objectId, as this will be generated
on creation.</p>

<p>Read is sent to Learn as a HTTP GET message with an empty body. The endpoint
should include the objectId being retrieved.</p>

<p>Update is sent to Learn as a HTTP PATCH message with a JSON body that defines
the object. The endpoint should include the objectId being updated.</p>

<p>Delete is sent to Learn as a HTTP DELETE message with empty body. The endpoint
should include the objectId being deleted.</p>

<p>The following shows the key components of the Python code for making REST
requests against each of the supported objects. In each case detailed messages
are printed to the terminal screen for you to follow the process.</p>

<hr />

<h4 id="datasources">Datasources</h4>

<p>Datasources are handled in <code class="highlighter-rouge">datasource.py</code>.</p>

<p><strong>Variables and Create Payload</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     self.DATASOURCES_PATH = '/learn/api/public/v1/dataSources' #create(POST)/get(GET)
     self.DATASOURCE_PATH = '/learn/api/public/v1/dataSources/externalId:'
     authStr = 'Bearer ' + token
    ...
     self.PAYLOAD = {
    Â Â Â Â  "externalId":DSKEXTERNALID,
    Â Â Â Â  "description":"Data Source used for REST demo"
     }
</code></pre></div></div>

<p><strong>Create</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    r = session.post("https://" + self.target_url + self.DATASOURCES_PATH, data=json.dumps(self.PAYLOAD), headers={'Authorization':authStr, 'Content-Type':'application/json'}, verify=False)
</code></pre></div></div>

<p><strong>Read</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    r = session.get("https://" + self.target_url + self.DATASOURCE_PATH+DSKEXTERNALID, headers={'Authorization':authStr, 'Content-Type':'application/json'}, verify=False)
    ...
    print("[DataSource:getDataSource()] RESPONSE: " + r.text)
</code></pre></div></div>

<p><strong>Update</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    r = session.patch("https://" + self.target_url + self.DATASOURCE_PATH+DSKEXTERNALID, data=json.dumps(self.PAYLOAD), headers={'Authorization':authStr, 'Content-Type':'application/json'}, verify=False)
    ...
    print("[DataSource:updateDataSource()] RESPONSE: " + r.text)
</code></pre></div></div>

<p><strong>Delete</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    r = session.delete("https://" + self.target_url + self.DATASOURCE_PATH+DSKEXTERNALID, headers={'Authorization':authStr, 'Content-Type':'application/json'}, verify=False)
</code></pre></div></div>

<hr />

<h4 id="terms">Terms</h4>

<p>Terms are handled in <code class="highlighter-rouge">term.py</code>. This Class contains the methods for creating,
reading, updating and deleting Term objects.</p>

<p><strong>Variables and Create Payload</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    self.terms_Path = '/learn/api/public/v1/terms' #create(POST)/get(GET)
    self.term_Path = '/learn/api/public/v1/terms/externalId:'
    self.termExternalId = TERMEXTERNALID #'BBDN-PYTHON-REST-DEMO-TERM'
    authStr = 'Bearer ' + token
    self.PAYLOAD = {
    Â Â Â Â  "externalId":self.termExternalId,
    Â Â Â Â  "dataSourceId": dsk, #self.dskExternalId, Supported soon.
    Â Â Â Â  "name":"REST Demo Term",
    Â Â Â Â  "description": "Term used for REST demo",
    Â Â Â Â  "availability": {
    Â Â Â Â Â Â Â Â Â  "duration":"Continuous"
    Â Â Â Â Â  }
    }
</code></pre></div></div>

<p><strong>Create</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    r = session.post("https://" + self.target_url + self.terms_Path, data=json.dumps(self.PAYLOAD), headers={'Authorization':authStr, 'Content-Type':'application/json'}, verify=False)
</code></pre></div></div>

<p><strong>Read</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    r = session.get("https://" + self.target_url + self.term_Path+self.termExternalId, headers={'Authorization':authStr},Â  verify=False)
    ...
    print("[Term:updateTerm()] RESPONSE: " + r.text)
    Update
    self.PAYLOAD = {
    Â Â Â Â Â Â  "externalId":self.termExternalId,
    Â Â Â Â Â Â  "dataSourceId": dsk, #self.dskExternalId, #Supported soon
    Â Â Â Â Â Â  "name":"REST Python Demo Term",
    Â Â Â Â Â Â  "description": "Term used for REST Python demo",
    Â Â Â Â Â Â  "availability": {
    Â Â Â Â Â Â Â Â Â Â Â Â Â  "duration":"continuous"
    Â Â Â Â Â Â  }
    }
    ...
    r = session.patch("https://" + self.target_url + self.term_Path+self.termExternalId, data=json.dumps(self.PAYLOAD), headers={'Authorization':authStr, 'Content-Type':'application/json'}, verify=False)
</code></pre></div></div>

<p><strong>Delete</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    r = session.delete("https://" + self.target_url + self.term_Path+self.termExternalId, headers={'Authorization':authStr}, verify=False)
</code></pre></div></div>

<hr />

<h4 id="courses">Courses</h4>

<p>Courses are handled in <code class="highlighter-rouge">course.py</code>. This class contains the methods for
creating, reading, updating and deleting course objects .</p>

<p><strong>Variables and Create Payload</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    self.courses_Path = '/learn/api/public/v1/courses' #create(POST)/get(GET)
    self.course_Path = '/learn/api/public/v1/courses/externalId:'
    self.termId = None
    self.PAYLOAD = {
    Â Â Â Â Â Â  "externalId":constants.COURSEEXTERNALID,
    Â Â Â Â Â Â  "dataSourceId": dsk, #self.dskExternalId, Supported soon.
    Â Â Â Â Â Â  "courseId":constants.COURSEEXTERNALID,
    Â Â Â Â Â Â  "name":"Course used for REST demo",
    Â Â Â Â Â Â  "description":"Course used for REST demo",
    Â Â Â Â Â Â  "allowGuests":"true",
    Â Â Â Â Â Â  "readOnly": "false",
    Â Â Â Â Â Â  "availability": {
    Â Â Â Â Â Â Â Â Â Â Â Â Â  "duration":"continuous"
    Â Â Â Â Â Â  }
    }
</code></pre></div></div>

<p><strong>Create</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    r = session.post("https://" + self.target_url + self.courses_Path, data=json.dumps(self.PAYLOAD), headers={'Authorization':authStr, 'Content-Type':'application/json'}, verify=False)
</code></pre></div></div>

<p><strong>Read</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    r = session.get("https://" + self.target_url + self.course_Path+constants.COURSEEXTERNALID, headers={'Authorization':authStr},Â  verify=False)
    ...
    print("[Course:getCourse()] RESPONSE: " + r.text)
</code></pre></div></div>

<p><strong>Update</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    self.PAYLOAD = {
    Â Â Â Â Â Â  "externalId":constants.COURSEEXTERNALID,
    Â Â Â Â Â Â  "dataSourceId": dsk, #self.dskExternalId, Supported soon.
    Â Â Â Â Â Â  "courseId":constants.COURSEEXTERNALID,
    Â Â Â Â Â Â  "name":"Course used for REST Python demo",
    Â Â Â Â Â Â  "description":"Course used for REST Python demo",
    Â Â Â Â Â Â  "allowGuests":"true",
    Â Â Â Â Â Â  "readOnly": "false",
    Â Â Â Â Â Â  "availability": {
    Â Â Â Â Â Â Â Â Â Â Â Â Â  "available":"Yes",
    Â Â Â Â Â Â Â Â Â Â Â Â Â  "duration":"continuous"
    Â Â Â Â Â Â  }
    }
    r = session.patch("https://" + self.target_url + self.course_Path+constants.COURSEEXTERNALID, data=json.dumps(self.PAYLOAD), headers={'Authorization':authStr, 'Content-Type':'application/json'}, verify=False)
</code></pre></div></div>

<p><strong>Delete</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    r = session.delete("https://" + self.target_url + self.course_Path+constants.COURSEEXTERNALID, headers={'Authorization':authStr}, verify=False)
</code></pre></div></div>

<hr />

<h4 id="users">Users</h4>

<p>Users are handled in <code class="highlighter-rouge">user.py</code>. This class contains the methods for creating,
reading, updating and deleting user objects .</p>

<p><strong>Variables and Create Payload</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    self.users_Path = '/learn/api/public/v1/users' #create(POST)/get(GET)
    self.user_Path = '/learn/api/public/v1/users/externalId:'
    self.PAYLOAD = {
    Â Â Â Â Â Â  "externalId":USEREXTERNALID,
    Â Â Â Â Â Â  "dataSourceId": dsk, #self.dskExternalId, Supported soon.
    Â Â Â Â Â Â  "userName":"python_demo",
    Â Â Â Â Â Â  "password":"python61",
    Â Â Â Â Â Â  "availability": {
    Â Â Â Â Â Â Â Â Â Â Â Â Â  "available": "Yes"
    Â Â Â Â Â Â  },
    Â Â Â Â Â Â  "name": {
    Â Â Â Â Â Â  "given": "Python",
    Â Â Â Â Â Â  "family": "Demo",
    Â Â Â Â Â Â  },
    Â Â Â Â Â Â  "contact": {
    Â Â Â Â Â Â  "email": "no.one@ereh.won",
    Â Â Â Â Â Â Â  }
    }
</code></pre></div></div>

<p><strong>Create</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    r = session.post("https://" + self.target_url + self.users_Path, data=json.dumps(self.PAYLOAD), headers={'Authorization':authStr, 'Content-Type':'application/json'}, verify=False)
</code></pre></div></div>

<p><strong>Read</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    r = session.get("https://" + self.target_url + self.user_Path+USEREXTERNALID, headers={'Authorization':authStr},Â  verify=False)
    ...
    print("[User:getUser()] RESPONSE: " + r.text)
</code></pre></div></div>

<p><strong>Update</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    self.PAYLOAD = {
    Â Â Â Â Â Â Â Â Â Â Â  "externalId": USEREXTERNALID,
    Â Â Â Â Â Â Â Â Â Â Â  "dataSourceId": dsk, #self.dskExternalId, Supported soon.
    Â Â Â Â Â Â Â Â Â Â Â  "userName":"python_demo",
    Â Â Â Â Â Â Â Â Â Â Â  "password": "python16",
    Â Â Â Â Â Â Â Â Â Â Â  "availability": {
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  "available": "Yes"
    Â Â Â Â Â Â Â Â Â Â Â  },
    Â Â Â Â Â Â Â Â Â Â Â  "name": {
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  "given": "Python",
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  "family": "BbDN",
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  "middle": "Demo",
    Â Â Â Â Â Â Â Â Â Â Â  },
    Â Â Â Â Â Â Â Â Â Â Â  "contact": {
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  "email": "no.one@ereh.won",
    Â Â Â Â Â Â Â Â Â Â Â  }
    Â Â Â Â Â Â Â  }
    ...
    r = session.patch("https://" + self.target_url + self.user_Path+USEREXTERNALID, data=json.dumps(self.PAYLOAD), headers={'Authorization':authStr, 'Content-Type':'application/json'}, verify=False)
</code></pre></div></div>

<p><strong>Delete</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    r = session.delete("https://" + self.target_url + self.user_Path+USEREXTERNALID, headers={'Authorization':authStr}, verify=False)
</code></pre></div></div>

<hr />

<h4 id="memberships">Memberships</h4>

<p>Memberships (enrollment/staff) are handled in <code class="highlighter-rouge">membership.py</code>. This class
contains the methods for creating, reading, updating and deleting membership
objects .</p>

<p><strong>Variables and Create Payload</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    self.PAYLOAD = {
    Â Â Â Â Â Â  "dataSourceId":dsk, #self.dskExternalId, supported soon.
    Â Â Â Â Â Â  "availability": {
    Â Â Â Â Â Â Â Â Â Â Â Â Â  "available":"Yes"
    Â Â Â Â Â Â  },
    Â Â Â Â Â Â  "courseRoleId":"Instructor"
    }
</code></pre></div></div>

<p><strong>Create</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    r = session.put("https://" + self.target_url + membership_Path, data=json.dumps(self.PAYLOAD), headers={'Authorization':authStr, 'Content-Type':'application/json'}, verify=False)
</code></pre></div></div>

<p><strong>Read</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    r = session.get("https://" + self.target_url + memberships_Path, headers={'Authorization':authStr}, verify=False)
    ...
    print("[Membership:getMemberships()] RESPONSE: " + r.text)
</code></pre></div></div>

<p><strong>Update</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    self.PAYLOAD = {
    Â Â Â Â Â Â  "dataSourceId":dsk,
    Â Â Â Â Â Â  "availability": {
    Â Â Â Â Â Â Â Â Â Â Â Â Â  "available":"No"
    Â Â Â Â Â Â  },
    Â Â Â Â Â Â  "courseRoleId":"Student"
    }
    ...
    r = session.patch("https://" + self.target_url + membership_Path, data=json.dumps(self.PAYLOAD), headers={'Authorization':authStr, 'Content-Type':'application/json'}, verify=False)
</code></pre></div></div>

<p><strong>Delete</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    r = session.delete("https://" + self.target_url + membership_Path, headers={'Authorization':authStr}, verify=False)
</code></pre></div></div>

<h3 id="conclusion">Conclusion</h3>

<p>All of the code snippets included in this document are included in a sample
REST Demo Python command line application available on
<a href="https://github.com/blackboard/BBDN-REST-DEMO_Python">GitHub</a>.
There is a README.html included that talks more specifically running the code.
Feel free to review the code and run it against a test or development Learn
instance to see how it works.</p>

:ET