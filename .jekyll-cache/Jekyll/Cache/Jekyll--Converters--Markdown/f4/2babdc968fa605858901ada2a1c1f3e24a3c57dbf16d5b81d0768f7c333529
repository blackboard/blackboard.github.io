I"Ò<h1 id="creating-database-objects-with-building-blocks">Creating Database Objects with Building Blocks</h1>
<p><em>Author: Kelley MacEwen</em><br />
<em>Categories: [‚ÄòOpenDB‚Äô, ‚ÄòTutorials‚Äô]</em><br />
<em>Tags: [‚Äòdevelop‚Äô, ‚Äòopendb‚Äô, ‚Äòblackboard learn‚Äô, ‚Äòdatabase‚Äô, ‚Äòdevelopers‚Äô, ‚Äòmigrated from edugarage‚Äô, ‚Äòdeveloper‚Äô]</em></p>
<hr />

<p>With Release 9.1, Blackboard included the ability for Building Blocks to
define schema elements in the .war file that would get automatically installed
and managed in the Learn database schema. However, that feature was limited to
Building Blocks that were signed and distributed by Blackboard.</p>

<p>As of 9.1 Service Pack 1 (R9.1SP1), that ‚Äúsign-gating‚Äù restriction has been
lifted. Building Blocks authored by independent developers can define and
install schema elements via special configuration files referenced from their
manifest. In some ways, this was in recognition of the fact that Building
Blocks frequently created custom schema objects directly. By enabling it as a
feature allows system admins to get more visibility into the process, and
ensure some level of consistency.</p>

<p>It should be noted that this is not on by default - Administrators must enable
this functionality from the Building Blocks management section of the admin
panel. The allowed schema actions are specified from the ‚ÄúGlobal Settings‚Äù
screen, including:</p>

<ul>
  <li>Prevent any Building Block from creating custom database objects</li>
  <li>Prompt each time a Building Block wants to create custom database objects</li>
  <li>Allow any Building Block to create custom database objects</li>
</ul>

<p>Also note that these options are not enforced for Blackboard-authored, signed
Building Blocks - that would disrupt the operation of some key features, such
as the Wiki, that are delivered via Building Blocks. The first option is the
default - no schema may be installed. The second option prompts the
administrator - previewing the tables/objects that would be created. The third
option simply processes the objects, without prompting the admin. That option
is only recommended for development, in order to facilitate rapid iteration.
In practice, we expect most administrators to choose ‚Äúprompt‚Äù, and then only
after attempting to install a Building Block and seeing the error message.</p>

<p>With great power comes great responsibility - there are a few things to keep
in mind when designing the schema using this mechanism:</p>

<ul>
  <li>Database objects must be prefixed with the vendor-id in the B2 manifest (the B2 installer will complain if the prefixes do not match).</li>
  <li>Minimize your dependency on Blackboard objects</li>
  <li>If you do need to link to a Blackboard database object, ensure that the relationship does not interfere with standard Blackboard processing - you must specify an on-delete action (cascade or setnull)</li>
  <li>The Blackboard schema is not an officially supported integration API, and will change from release to release.</li>
  <li>Test test test - if you do reference a core entity, such as a course or user, make sure you can still delete that entity</li>
</ul>

<h1 id="getting-started">Getting Started</h1>

<p>The schema is defined primarily via a file called schema.xml, which is part of
a directory structure that also defines various SQL scripts - procedures,
functions, views, etc. One or more schema definition directories are
referenced via the schema-dirs element in the manifest, as follows:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;schema-dirs&gt;
  &lt;schema-dir dir-name="test"/&gt;
  &lt;schema-dir dir-name="statstest" database="stats"/&gt;
&lt;/schema-dirs&gt;
</code></pre></div></div>

<p>The dir-name attribute is evaluated first against the webapp root, then
against WEB-INF. The schema.xml should be in that directory; all other scripts
are in sub-directories. The database attribute indicates which schema the
objects should be created in. By default, the objects are created in the
transactional schema - so if you are creating tables to support the day-to-day
features of your Building Block, you would not need to define this value.
Tables and other objects can also be created in the reporting schema by using
the value ‚Äústats‚Äù. As of R9.1SP1, there are no other supported values.</p>

<p>See <a href="Schema%20Definitions.html">Schema Definitions</a> for
more information on the structure of schema.xml, the containing directory
structure, and the supporting scripts.</p>

<h1 id="next-steps">Next Steps</h1>

<p>Take a look at <a href="Tutorial%20-%20Schema%20.xml">Tutorial -
Schema.XML</a> for an in-depth
look and working example using schema.xml to store building block
configuration details in a custom database table.</p>

:ET